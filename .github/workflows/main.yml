name: SSH VPS

on:
  workflow_dispatch:

jobs:
  sshvps:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸš€ Setup SSH VPS
        run: |
          echo "ğŸ“¦ Updating packages..."
          sudo apt update
          sudo apt install -y openssh-server wget curl

          echo "ğŸ”‘ Starting SSH service..."
          sudo service ssh start

          echo "ğŸ‘¤ Creating SSH user..."
          sudo useradd -m govinda
          echo 'govinda:password123' | sudo chpasswd
          sudo usermod -aG sudo govinda

          echo "â˜ï¸ Downloading working Cloudflared binary..."
          wget -O cloudflared.tgz https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.tgz
          tar -xvzf cloudflared.tgz
          chmod +x cloudflared
          ./cloudflared --version

          echo "ğŸŒ Starting Cloudflared tunnel..."
          ./cloudflared tunnel --url ssh://localhost:22 --no-autoupdate > tunnel.log 2>&1 &
          sleep 10

          echo "ğŸ“¡ Tunnel URL:"
          grep -i 'trycloudflare.com' tunnel.log || echo "âŒ Tunnel URL not found!"
